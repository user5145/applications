build-extension: true

id: com.blizzard.Diablo2.glide
branch: alfa

runtime: com.blizzard.Diablo2//alfa
sdk: org.winepak.Sdk/i386/3.0

separate-locales: false
appstream-compose: false

modules:
  - name: lod
    buildsystem: simple
    build-commands:      
      - install -d ${FLATPAK_DEST}/bin
      - install -Dm555 installer ${FLATPAK_DEST}/bin
      - install -Dm555 starter ${FLATPAK_DEST}/bin

    sources:
      - type: extra-data
        url: http://www.svenswrapper.de/gl32ogl14e.zip
        sha256: cd9d3688b35decf0fbd4c97d584577a7628e74aeac808f0a0a52fbcfdd1818c6
        filename: glide.zip
        size: 157116

      - type: script
        dest-filename: installer
        commands:
          - if [ ! -e "${WINEPREFIX}/drive_c/Program Files/Diablo II/glide-init.exe" ] ; then
          -     echo "installing glide"
          -     install -d "${WINEPREFIX}/drive_c/Program Files/Diablo II/"
          -     unzip $(dirname $0)/../extra/glide.zip -d "${WINEPREFIX}/drive_c/Program Files/Diablo II/"
          - fi

      - type: script
        dest-filename: starter
        commands:
          - echo starting glide
          - cd "${WINEPREFIX}/drive_c/Program Files/Diablo II/"
          - wine "C:/Program Files/Diablo II/glide-init.exe"
          - "set -- -3dfx $@"

  - name: metainfo
    buildsystem: simple
    build-commands:
      - install -Dm644 --target-directory=${FLATPAK_DEST}/share/metainfo com.blizzard.Diablo2.glide.metainfo.xml
    sources:
      - type: file
        path: com.blizzard.Diablo2.glide.metainfo.xml
